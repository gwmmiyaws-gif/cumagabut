local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

local svc = {
    RS = game:GetService("ReplicatedStorage"),
}

local mods = {
    Net = svc.RS.Packages._Index["sleitnick_net@0.2.0"].net,
}

local api = {
    Functions = {
        ChargeRod = mods.Net["RF/ChargeFishingRod"],
        StartMini = mods.Net["RF/RequestFishingMinigameStarted"],
        CatchFish = mods.Net["RF/CatchFishCompleted"],
        CancelFish = mods.Net["RF/CancelFishingInputs"],
    },
}

local Window = WindUI:CreateWindow({
    Title = "Fish Call Logger",
    Author = "Patungin",
    Folder = "FishLogger",
    Size = UDim2.fromOffset(600, 500),
    ToggleKey = Enum.KeyCode.G,
})

local Main = Window:Tab({
    Title = "Logger",
    Icon = "file-text",
})

local Output = Window:Tab({
    Title = "Output",
    Icon = "copy",
})

-- Storage
local LoggedCalls = {}
local IsLogging = false
local LastCallTime = 0
local LogStartTime = 0

-- Stats
local Stats = {
    TotalCalls = 0,
    ChargeRod = 0,
    StartMini = 0,
    CatchFish = 0,
    CancelFish = 0,
}

-- Original functions
local OriginalChargeRod = api.Functions.ChargeRod.InvokeServer
local OriginalStartMini = api.Functions.StartMini.InvokeServer
local OriginalCatchFish = api.Functions.CatchFish.InvokeServer
local OriginalCancelFish = api.Functions.CancelFish.InvokeServer

-- Output Display Variables
local LogOutputText = ""
local CodeOutputText = ""

local function FormatArgs(args)
    local formatted = {}
    for i, v in ipairs(args) do
        if type(v) == "number" then
            formatted[i] = string.format("%.10f", v)
        elseif v == nil then
            formatted[i] = "nil"
        else
            formatted[i] = tostring(v)
        end
    end
    return table.concat(formatted, ", ")
end

local function StartLogging()
    LoggedCalls = {}
    LogStartTime = tick()
    LastCallTime = LogStartTime
    Stats.TotalCalls = 0
    Stats.ChargeRod = 0
    Stats.StartMini = 0
    Stats.CatchFish = 0
    Stats.CancelFish = 0
    
    -- Hook ChargeRod
    api.Functions.ChargeRod.InvokeServer = function(self, ...)
        local result = OriginalChargeRod(self, ...)
        
        if IsLogging then
            local now = tick()
            local delta = now - LastCallTime
            local timestamp = now - LogStartTime
            local args = {...}
            
            local logEntry = string.format(
                "[%.6fs] [Î”%.6fs] ChargeRod(%s)",
                timestamp,
                delta,
                FormatArgs(args)
            )
            
            table.insert(LoggedCalls, logEntry)
            
            Stats.ChargeRod = Stats.ChargeRod + 1
            Stats.TotalCalls = Stats.TotalCalls + 1
            LastCallTime = now
        end
        
        return result
    end
    
    -- Hook StartMini
    api.Functions.StartMini.InvokeServer = function(self, ...)
        local result = OriginalStartMini(self, ...)
        
        if IsLogging then
            local now = tick()
            local delta = now - LastCallTime
            local timestamp = now - LogStartTime
            local args = {...}
            
            local logEntry = string.format(
                "[%.6fs] [Î”%.6fs] StartMini(%s)",
                timestamp,
                delta,
                FormatArgs(args)
            )
            
            table.insert(LoggedCalls, logEntry)
            
            Stats.StartMini = Stats.StartMini + 1
            Stats.TotalCalls = Stats.TotalCalls + 1
            LastCallTime = now
        end
        
        return result
    end
    
    -- Hook CatchFish
    api.Functions.CatchFish.InvokeServer = function(self, ...)
        local result = OriginalCatchFish(self, ...)
        
        if IsLogging then
            local now = tick()
            local delta = now - LastCallTime
            local timestamp = now - LogStartTime
            local args = {...}
            
            local logEntry = string.format(
                "[%.6fs] [Î”%.6fs] CatchFish(%s)",
                timestamp,
                delta,
                FormatArgs(args)
            )
            
            table.insert(LoggedCalls, logEntry)
            
            Stats.CatchFish = Stats.CatchFish + 1
            Stats.TotalCalls = Stats.TotalCalls + 1
            LastCallTime = now
        end
        
        return result
    end
    
    -- Hook CancelFish
    api.Functions.CancelFish.InvokeServer = function(self, ...)
        local result = OriginalCancelFish(self, ...)
        
        if IsLogging then
            local now = tick()
            local delta = now - LastCallTime
            local timestamp = now - LogStartTime
            local args = {...}
            
            local logEntry = string.format(
                "[%.6fs] [Î”%.6fs] CancelFish(%s)",
                timestamp,
                delta,
                FormatArgs(args)
            )
            
            table.insert(LoggedCalls, logEntry)
            
            Stats.CancelFish = Stats.CancelFish + 1
            Stats.TotalCalls = Stats.TotalCalls + 1
            LastCallTime = now
        end
        
        return result
    end
end

local function GenerateLogOutput()
    if #LoggedCalls == 0 then
        return "No logged calls yet. Start logging and fish manually!"
    end
    
    local output = {}
    
    table.insert(output, "========== FISHING CALL LOG ==========")
    table.insert(output, "Total Calls: " .. Stats.TotalCalls)
    table.insert(output, string.format("Duration: %.3fs", tick() - LogStartTime))
    table.insert(output, "")
    table.insert(output, "Breakdown:")
    table.insert(output, "  ChargeRod: " .. Stats.ChargeRod)
    table.insert(output, "  StartMini: " .. Stats.StartMini)
    table.insert(output, "  CatchFish: " .. Stats.CatchFish)
    table.insert(output, "  CancelFish: " .. Stats.CancelFish)
    table.insert(output, "--------------------------------------")
    table.insert(output, "")
    
    for i, log in ipairs(LoggedCalls) do
        table.insert(output, log)
    end
    
    table.insert(output, "")
    table.insert(output, "========== END OF LOG ==========")
    
    return table.concat(output, "\n")
end

local function GenerateCodeOutput()
    if #LoggedCalls == 0 then
        return "No logged calls yet. Start logging and fish manually!"
    end
    
    local output = {}
    
    table.insert(output, "-- Auto-generated fishing pattern")
    table.insert(output, "-- Total Calls: " .. Stats.TotalCalls)
    table.insert(output, "")
    table.insert(output, "local function ReplayPattern()")
    table.insert(output, "    local api = {")
    table.insert(output, "        Functions = {")
    table.insert(output, '            ChargeRod = game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net["RF/ChargeFishingRod"],')
    table.insert(output, '            StartMini = game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net["RF/RequestFishingMinigameStarted"],')
    table.insert(output, '            CatchFish = game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net["RF/CatchFishCompleted"],')
    table.insert(output, '            CancelFish = game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net["RF/CancelFishingInputs"],')
    table.insert(output, "        }")
    table.insert(output, "    }")
    table.insert(output, "")
    table.insert(output, "    local calls = {")
    
    -- Parse calls
    for i, log in ipairs(LoggedCalls) do
        local delta = log:match("%[Î”([%d%.]+)s%]")
        local funcName = log:match("]%s(%w+)%(")
        local args = log:match("%((.*)%)")
        
        if delta and funcName and args then
            table.insert(output, string.format('        {delta = %.6f, func = "%s", args = {%s}},', tonumber(delta), funcName, args))
        end
    end
    
    table.insert(output, "    }")
    table.insert(output, "")
    table.insert(output, "    for _, call in ipairs(calls) do")
    table.insert(output, "        task.wait(call.delta)")
    table.insert(output, "")
    table.insert(output, '        if call.func == "ChargeRod" then')
    table.insert(output, "            api.Functions.ChargeRod:InvokeServer(unpack(call.args))")
    table.insert(output, '        elseif call.func == "StartMini" then')
    table.insert(output, "            api.Functions.StartMini:InvokeServer(unpack(call.args))")
    table.insert(output, '        elseif call.func == "CatchFish" then')
    table.insert(output, "            api.Functions.CatchFish:InvokeServer(unpack(call.args))")
    table.insert(output, '        elseif call.func == "CancelFish" then')
    table.insert(output, "            api.Functions.CancelFish:InvokeServer(unpack(call.args))")
    table.insert(output, "        end")
    table.insert(output, "    end")
    table.insert(output, "end")
    table.insert(output, "")
    table.insert(output, "-- Loop the pattern")
    table.insert(output, "while true do")
    table.insert(output, "    ReplayPattern()")
    table.insert(output, "end")
    
    return table.concat(output, "\n")
end

-- UI - Main Tab
local ControlSection = Main:Section({
    Title = "Logging Controls"
})

ControlSection:Toggle({
    Title = "Start Logging",
    Description = "Log all fishing calls with delta timing",
    Default = false,
    Callback = function(state)
        IsLogging = state
        
        if state then
            StartLogging()
            Window:Notify({
                Title = "Logging Started",
                Content = "Go fish manually now!",
                Duration = 3
            })
        else
            Window:Notify({
                Title = "Logging Stopped",
                Content = "Logged " .. Stats.TotalCalls .. " calls",
                Duration = 3
            })
        end
    end
})

local StatsSection = Main:Section({
    Title = "Statistics"
})

local TotalLabel = StatsSection:Label({
    Title = "Total Calls: 0"
})

local ChargeLabel = StatsSection:Label({
    Title = "ChargeRod: 0"
})

local MiniLabel = StatsSection:Label({
    Title = "StartMini: 0"
})

local CatchLabel = StatsSection:Label({
    Title = "CatchFish: 0"
})

local CancelLabel = StatsSection:Label({
    Title = "CancelFish: 0"
})

local ActionsSection = Main:Section({
    Title = "Actions"
})

ActionsSection:Button({
    Title = "Generate Output",
    Description = "Generate log & code in Output tab",
    Callback = function()
        LogOutputText = GenerateLogOutput()
        CodeOutputText = GenerateCodeOutput()
        
        Window:Notify({
            Title = "Generated!",
            Content = "Check Output tab to view & copy",
            Duration = 3
        })
    end
})

ActionsSection:Button({
    Title = "Clear All Logs",
    Callback = function()
        LoggedCalls = {}
        Stats.TotalCalls = 0
        Stats.ChargeRod = 0
        Stats.StartMini = 0
        Stats.CatchFish = 0
        Stats.CancelFish = 0
        LogOutputText = ""
        CodeOutputText = ""
        
        Window:Notify({
            Title = "Cleared",
            Content = "All logs cleared",
            Duration = 2
        })
    end
})

-- UI - Output Tab
local LogSection = Output:Section({
    Title = "Log Output (Delta Timing)"
})

LogSection:Paragraph({
    Title = "Instructions",
    Description = "Select all text below (click & drag), then copy (Ctrl+C or long press)"
})

local LogTextbox = LogSection:Input({
    Title = "Log Output",
    Description = "Select & copy this text",
    Placeholder = "Generate output first...",
    Value = "",
    Multiline = true,
    Callback = function(value)
        -- Readonly, jadi ga perlu callback
    end
})

LogSection:Button({
    Title = "ðŸ“‹ Copy Log to Clipboard",
    Callback = function()
        pcall(function()
            setclipboard(LogOutputText)
            Window:Notify({
                Title = "âœ… Copied!",
                Content = "Log copied to clipboard",
                Duration = 2
            })
        end)
    end
})

local CodeSection = Output:Section({
    Title = "Lua Code Output"
})

CodeSection:Paragraph({
    Title = "Instructions",
    Description = "Select all code below (click & drag), then copy (Ctrl+C or long press)"
})

local CodeTextbox = CodeSection:Input({
    Title = "Code Output",
    Description = "Select & copy this code",
    Placeholder = "Generate output first...",
    Value = "",
    Multiline = true,
    Callback = function(value)
        -- Readonly
    end
})

CodeSection:Button({
    Title = "ðŸ“‹ Copy Code to Clipboard",
    Callback = function()
        pcall(function()
            setclipboard(CodeOutputText)
            Window:Notify({
                Title = "âœ… Copied!",
                Content = "Code copied to clipboard",
                Duration = 2
            })
        end)
    end
})

-- Update stats & outputs
spawn(function()
    while true do
        TotalLabel:Set("Total Calls: " .. Stats.TotalCalls)
        ChargeLabel:Set("ChargeRod: " .. Stats.ChargeRod)
        MiniLabel:Set("StartMini: " .. Stats.StartMini)
        CatchLabel:Set("CatchFish: " .. Stats.CatchFish)
        CancelLabel:Set("CancelFish: " .. Stats.CancelFish)
        
        -- Auto-update textboxes if there's new data
        if #LoggedCalls > 0 and LogOutputText == "" then
            LogOutputText = GenerateLogOutput()
            CodeOutputText = GenerateCodeOutput()
        end
        
        -- Update textbox values
        if LogOutputText ~= "" then
            LogTextbox:Set({Value = LogOutputText})
        end
        
        if CodeOutputText ~= "" then
            CodeTextbox:Set({Value = CodeOutputText})
        end
        
        task.wait(0.5)
    end
end)

Window:Notify({
    Title = "Fish Logger Loaded!",
    Content = "Start logging & generate output!",
    Duration = 5
})

print("ðŸŽ£ Fish Call Logger with UI Output!")
print("1. Toggle 'Start Logging'")
print("2. Fish manually")
print("3. Toggle off & click 'Generate Output'")
print("4. Go to 'Output' tab")
print("5. Select text & copy!")
