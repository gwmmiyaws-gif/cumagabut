local WindUI

do
    local ok, result = pcall(function()
        return require("./src/Init")
    end)
    
    if ok then
        WindUI = result
    else 
        WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
    end
end

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Blatant Beta Variables (Ultra Fast)
local BlatantConfig = {
    Active = false,
    CastDelay = 0.4,          -- Delay antar cast (SUPER CEPAT)
    CompleteDelay = 0.15,     -- Delay sebelum complete (INSTANT)
    EquipInterval = 1.2,      -- Interval equip rod
    MultiCast = true,         -- Cast multiple times
    CastPerCycle = 3,         -- Berapa kali cast per cycle
    UseParallel = true,       -- Parallel execution
}

local BlatantRemotes = {
    ChargeFishingRod = nil,
    RequestFishingMinigameStarted = nil,
    FishingCompleted = nil,
    EquipToolFromHotbar = nil,
    CancelFishingInputs = nil
}

local BlatantStats = {
    TotalCatches = 0,
    SessionStart = 0,
    CatchesPerMinute = 0
}

-- Initialize Blatant Remotes
local function InitRemotes()
    pcall(function()
        local net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
        BlatantRemotes.ChargeFishingRod = net:WaitForChild("RF/ChargeFishingRod")
        BlatantRemotes.RequestFishingMinigameStarted = net:WaitForChild("RF/RequestFishingMinigameStarted")
        BlatantRemotes.FishingCompleted = net:WaitForChild("RE/FishingCompleted")
        BlatantRemotes.EquipToolFromHotbar = net:WaitForChild("RE/EquipToolFromHotbar")
        BlatantRemotes.CancelFishingInputs = net:WaitForChild("RF/CancelFishingInputs")
    end)
end

InitRemotes()

local BlatantMainThread = nil
local BlatantEquipThread = nil

-- Ultra Fast Single Cast
local function FastCast()
    task.spawn(function()
        pcall(function()
            -- Cancel & Charge secara parallel
            BlatantRemotes.CancelFishingInputs:InvokeServer()
            BlatantRemotes.ChargeFishingRod:InvokeServer(math.huge)
            BlatantRemotes.RequestFishingMinigameStarted:InvokeServer(-139.63, 0.996)
        end)
    end)
    
    -- Complete setelah delay minimal
    task.spawn(function()
        task.wait(BlatantConfig.CompleteDelay)
        if BlatantConfig.Active then
            pcall(function()
                BlatantRemotes.FishingCompleted:FireServer()
                BlatantStats.TotalCatches += 1
            end)
        end
    end)
end

-- Multi-Cast System (Cast beberapa kali sekaligus)
local function MultiCastCycle()
    if BlatantConfig.MultiCast then
        -- Cast multiple times dengan delay minimal
        for i = 1, BlatantConfig.CastPerCycle do
            if not BlatantConfig.Active then break end
            FastCast()
            task.wait(0.05) -- Delay minimal antar cast
        end
    else
        FastCast()
    end
end

-- Parallel Casting (Multiple casts sekaligus)
local function ParallelCast()
    local threads = {}
    
    for i = 1, BlatantConfig.CastPerCycle do
        threads[i] = task.spawn(function()
            task.wait((i-1) * 0.03) -- Stagger delay
            FastCast()
        end)
    end
    
    -- Wait untuk semua complete
    task.wait(BlatantConfig.CompleteDelay + 0.1)
end

-- Auto Equip Rod (Background)
local function AutoEquipRod()
    while BlatantConfig.Active do
        pcall(function()
            BlatantRemotes.EquipToolFromHotbar:FireServer(1)
        end)
        task.wait(BlatantConfig.EquipInterval)
    end
end

-- Main Fishing Loop (Ultra Fast)
local function StartBlatantFishing()
    BlatantStats.SessionStart = os.time()
    BlatantStats.TotalCatches = 0
    
    -- Start equip thread
    BlatantEquipThread = task.spawn(AutoEquipRod)
    
    -- Initial equip
    task.wait(0.2)
    pcall(function()
        BlatantRemotes.EquipToolFromHotbar:FireServer(1)
    end)
    task.wait(0.3)
    
    -- Main ultra-fast loop
    while BlatantConfig.Active do
        if BlatantConfig.UseParallel then
            -- Parallel execution (FASTEST)
            ParallelCast()
        else
            -- Sequential multi-cast
            MultiCastCycle()
        end
        
        -- Minimal delay antar cycle
        task.wait(BlatantConfig.CastDelay)
        
        -- Update CPM (Catches Per Minute)
        local elapsed = os.time() - BlatantStats.SessionStart
        if elapsed > 0 then
            BlatantStats.CatchesPerMinute = math.floor((BlatantStats.TotalCatches / elapsed) * 60)
        end
    end
end

local function ToggleBlatantFishing(state)
    BlatantConfig.Active = state
    
    if state then
        -- Cancel existing threads
        if BlatantMainThread then task.cancel(BlatantMainThread) end
        if BlatantEquipThread then task.cancel(BlatantEquipThread) end
        
        -- Start new thread
        BlatantMainThread = task.spawn(StartBlatantFishing)
    else
        -- Stop threads
        if BlatantMainThread then task.cancel(BlatantMainThread) end
        if BlatantEquipThread then task.cancel(BlatantEquipThread) end
        BlatantMainThread = nil
        BlatantEquipThread = nil
        
        -- Cancel fishing
        pcall(function()
            BlatantRemotes.CancelFishingInputs:InvokeServer()
        end)
    end
end

local Window = WindUI:CreateWindow({
    Title = "LS Hub - Fish It",
    Author = "developed by Louissxe",
    Folder = "LSHub-FishIt",
    Icon = "rbxassetid://129609617845057",
    Transparent = true,
    IconSize = 12*2,
    NewElements = true,
    Size = UDim2.fromOffset(580, 380),
    ToggleKey = Enum.KeyCode.G,
    User = {
        Enabled = true,
        Anonymous = true,
    },
    HideSearchBar = false,
    OpenButton = {
        Title = "Open LS Hub",
        CornerRadius = UDim.new(0.3,0),
        StrokeThickness = 3,
        Enabled = true,
        Draggable = true,
        OnlyMobile = false,
        Color = ColorSequence.new(
            Color3.fromRGB(107, 49, 255), 
            Color3.fromRGB(215, 48, 221)
        )
    },
    Topbar = {
        Height = 44,
        ButtonsType = "Default",
    },
})

-- TAB FISHING (BLATANT BETA)
local fishing = Window:Tab({
    Title = "Fishing",
    Icon = "fish",
    IconColor = Color3.fromHex("#00ff88"),
    IconShape = true,
})

local blatant = fishing:Section({
    Title = "Blatant Beta - Ultra Fast",
    Icon = "zap",
    TextXAlignment = "Left",
    TextSize = 17
})

fishing:Divider()

blatant:Toggle({
    Title = "Enable Blatant Beta",
    Desc = "Ultra fast multi-cast fishing system",
    Value = BlatantConfig.Active,
    Callback = function(state)
        ToggleBlatantFishing(state)
        
        if state then
            WindUI:Notify({
                Title = "Blatant Beta Started",
                Content = "Ultra fast mode activated!",
                Duration = 3,
                Icon = "zap"
            })
        else
            local runtime = os.time() - BlatantStats.SessionStart
            local minutes = math.floor(runtime / 60)
            local seconds = runtime % 60
            
            WindUI:Notify({
                Title = "Blatant Beta Stopped",
                Content = string.format("Catches: %d | CPM: %d | Time: %dm %ds", 
                    BlatantStats.TotalCatches,
                    BlatantStats.CatchesPerMinute,
                    minutes,
                    seconds
                ),
                Duration = 6,
                Icon = "info"
            })
        end
    end
})

fishing:Divider()

local mode = fishing:Section({
    Title = "Casting Mode",
    Icon = "settings",
    TextXAlignment = "Left",
    TextSize = 16
})

mode:Toggle({
    Title = "Parallel Casting",
    Desc = "Cast multiple times simultaneously (FASTEST)",
    Value = BlatantConfig.UseParallel,
    Callback = function(state)
        BlatantConfig.UseParallel = state
        WindUI:Notify({
            Title = "Mode Changed",
            Content = state and "Parallel Mode" or "Sequential Mode",
            Duration = 2,
            Icon = "info"
        })
    end
})

mode:Toggle({
    Title = "Multi-Cast",
    Desc = "Enable multiple casts per cycle",
    Value = BlatantConfig.MultiCast,
    Callback = function(state)
        BlatantConfig.MultiCast = state
    end
})

mode:Slider({
    Title = "Casts Per Cycle",
    Desc = "How many times to cast per cycle (more = faster)",
    Step = 1,
    Value = {
        Min = 1,
        Max = 10,
        Default = BlatantConfig.CastPerCycle
    },
    Callback = function(value)
        BlatantConfig.CastPerCycle = value
        WindUI:Notify({
            Title = "Setting Updated",
            Content = value .. " casts per cycle",
            Duration = 2,
            Icon = "info"
        })
    end
})

fishing:Divider()

local timing = fishing:Section({
    Title = "Timing Settings",
    Icon = "clock",
    TextXAlignment = "Left",
    TextSize = 16
})

timing:Slider({
    Title = "Cast Delay",
    Desc = "Delay between casting cycles (lower = faster)",
    Step = 0.05,
    Value = {
        Min = 0.1,
        Max = 2.0,
        Default = BlatantConfig.CastDelay
    },
    Callback = function(value)
        BlatantConfig.CastDelay = value
    end
})

timing:Slider({
    Title = "Complete Delay",
    Desc = "Delay before completing catch (lower = faster)",
    Step = 0.05,
    Value = {
        Min = 0.05,
        Max = 1.0,
        Default = BlatantConfig.CompleteDelay
    },
    Callback = function(value)
        BlatantConfig.CompleteDelay = value
    end
})

timing:Slider({
    Title = "Equip Interval",
    Desc = "How often to auto-equip rod",
    Step = 0.1,
    Value = {
        Min = 0.5,
        Max = 3.0,
        Default = BlatantConfig.EquipInterval
    },
    Callback = function(value)
        BlatantConfig.EquipInterval = value
    end
})

fishing:Divider()

local stats = fishing:Section({
    Title = "Statistics & Info",
    Icon = "bar-chart",
    TextXAlignment = "Left",
    TextSize = 16
})

stats:Button({
    Title = "View Live Stats",
    Desc = "Show current fishing statistics",
    Icon = "activity",
    Callback = function()
        local runtime = os.time() - BlatantStats.SessionStart
        local minutes = math.floor(runtime / 60)
        local seconds = runtime % 60
        
        WindUI:Notify({
            Title = "Live Statistics",
            Content = string.format(
                "Total Catches: %d\nCatches/Min: %d\nRuntime: %dm %ds\nMode: %s",
                BlatantStats.TotalCatches,
                BlatantStats.CatchesPerMinute,
                minutes,
                seconds,
                BlatantConfig.UseParallel and "Parallel" or "Sequential"
            ),
            Duration = 8,
            Icon = "info"
        })
    end
})

stats:Button({
    Title = "Reset Stats",
    Desc = "Clear all statistics",
    Icon = "refresh-cw",
    Callback = function()
        BlatantStats.TotalCatches = 0
        BlatantStats.SessionStart = os.time()
        BlatantStats.CatchesPerMinute = 0
        
        WindUI:Notify({
            Title = "Stats Reset",
            Content = "All statistics cleared",
            Duration = 2,
            Icon = "check"
        })
    end
})

fishing:Divider()

local presets = fishing:Section({
    Title = "Speed Presets",
    Icon = "gauge",
    TextXAlignment = "Left",
    TextSize = 16
})

presets:Button({
    Title = "üêå Safe Mode",
    Desc = "Slower but safer (3-5 catches/min)",
    Callback = function()
        BlatantConfig.CastDelay = 1.5
        BlatantConfig.CompleteDelay = 0.5
        BlatantConfig.CastPerCycle = 1
        BlatantConfig.UseParallel = false
        WindUI:Notify({Title = "Preset Applied", Content = "Safe Mode", Duration = 2})
    end
})

presets:Button({
    Title = "‚ö° Fast Mode",
    Desc = "Balanced speed (8-12 catches/min)",
    Callback = function()
        BlatantConfig.CastDelay = 0.6
        BlatantConfig.CompleteDelay = 0.25
        BlatantConfig.CastPerCycle = 2
        BlatantConfig.UseParallel = false
        WindUI:Notify({Title = "Preset Applied", Content = "Fast Mode", Duration = 2})
    end
})

presets:Button({
    Title = "üöÄ Ultra Mode",
    Desc = "Maximum speed (15-25 catches/min)",
    Callback = function()
        BlatantConfig.CastDelay = 0.3
        BlatantConfig.CompleteDelay = 0.15
        BlatantConfig.CastPerCycle = 4
        BlatantConfig.UseParallel = true
        WindUI:Notify({Title = "Preset Applied", Content = "Ultra Mode", Duration = 2})
    end
})

presets:Button({
    Title = "üíÄ Insane Mode",
    Desc = "EXTREME SPEED (30+ catches/min) - USE AT OWN RISK!",
    Callback = function()
        BlatantConfig.CastDelay = 0.15
        BlatantConfig.CompleteDelay = 0.08
        BlatantConfig.CastPerCycle = 8
        BlatantConfig.UseParallel = true
        WindUI:Notify({
            Title = "‚ö†Ô∏è WARNING",
            Content = "Insane Mode - May cause detection!",
            Duration = 4,
            Icon = "alert-triangle"
        })
    end
})
