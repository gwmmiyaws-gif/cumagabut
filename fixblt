local WindUI

do
    local ok, result = pcall(function()
        return require("./src/Init")
    end)
    
    if ok then
        WindUI = result
    else 
        WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
    end
end

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- Blatant Beta Variables
local BlatantConfig = {
    Active = false,
    CancelDelay = 1.6,
    CompleteDelay = 0.37
}

local BlatantRemotes = {
    ChargeFishingRod = nil,
    RequestFishingMinigameStarted = nil,
    FishingCompleted = nil,
    EquipToolFromHotbar = nil,
    CancelFishingInputs = nil
}

-- Initialize Blatant Remotes
pcall(function()
    local net = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
    BlatantRemotes.ChargeFishingRod = net:WaitForChild("RF/ChargeFishingRod")
    BlatantRemotes.RequestFishingMinigameStarted = net:WaitForChild("RF/RequestFishingMinigameStarted")
    BlatantRemotes.FishingCompleted = net:WaitForChild("RE/FishingCompleted")
    BlatantRemotes.EquipToolFromHotbar = net:WaitForChild("RE/EquipToolFromHotbar")
    BlatantRemotes.CancelFishingInputs = net:WaitForChild("RF/CancelFishingInputs")
end)

local BlatantMainThread = nil
local BlatantEquipThread = nil

local function BlatantFishingCycle()
    task.spawn(function()
        pcall(function()
            local success, result = BlatantRemotes.CancelFishingInputs:InvokeServer()
            if not success then
                while not success do
                    local retry = BlatantRemotes.CancelFishingInputs:InvokeServer()
                    if retry then break end
                    task.wait(0.05)
                end
            end
            local chargeSuccess, chargeResult = BlatantRemotes.ChargeFishingRod:InvokeServer(math.huge)
            if not chargeSuccess then
                while not chargeSuccess do
                    local retryCharge = BlatantRemotes.ChargeFishingRod:InvokeServer(math.huge)
                    if retryCharge then break end
                    task.wait(0.05)
                end
            end
            BlatantRemotes.RequestFishingMinigameStarted:InvokeServer(-139.63, 0.996)
        end)
    end)
    task.spawn(function()
        task.wait(BlatantConfig.CompleteDelay)
        if BlatantConfig.Active then
            pcall(BlatantRemotes.FishingCompleted.FireServer, BlatantRemotes.FishingCompleted)
        end
    end)
end

local function StartBlatantFishing()
    BlatantEquipThread = task.spawn(function()
        while BlatantConfig.Active do
            pcall(BlatantRemotes.EquipToolFromHotbar.FireServer, BlatantRemotes.EquipToolFromHotbar, 1)
            task.wait(1.5)
        end
    end)
    
    while BlatantConfig.Active do
        BlatantFishingCycle()
        task.wait(BlatantConfig.CancelDelay)
        if not BlatantConfig.Active then break end
        task.wait(0.1)
    end
end

local function ToggleBlatantFishing(state)
    BlatantConfig.Active = state
    if state then
        if BlatantMainThread then task.cancel(BlatantMainThread) end
        if BlatantEquipThread then task.cancel(BlatantEquipThread) end
        BlatantMainThread = task.spawn(StartBlatantFishing)
    else
        if BlatantMainThread then task.cancel(BlatantMainThread) end
        if BlatantEquipThread then task.cancel(BlatantEquipThread) end
        BlatantMainThread = nil
        BlatantEquipThread = nil
        pcall(BlatantRemotes.CancelFishingInputs.InvokeServer, BlatantRemotes.CancelFishingInputs)
    end
end

local Window = WindUI:CreateWindow({
    Title = "LS Hub - Fish It",
    Author = "developed by Louissxe",
    Folder = "LSHub-FishIt",
    Icon = "rbxassetid://129609617845057",
    Transparent = true,
    IconSize = 12*2,
    NewElements = true,
    Size = UDim2.fromOffset(580, 380),
    ToggleKey = Enum.KeyCode.G,
    User = {
        Enabled = true,
        Anonymous = true,
    },
    HideSearchBar = false,
    OpenButton = {
        Title = "Open LS Hub",
        CornerRadius = UDim.new(0.3,0),
        StrokeThickness = 3,
        Enabled = true,
        Draggable = true,
        OnlyMobile = false,
        Color = ColorSequence.new(
            Color3.fromRGB(107, 49, 255), 
            Color3.fromRGB(215, 48, 221)
        )
    },
    Topbar = {
        Height = 44,
        ButtonsType = "Default",
    },
})

-- TAB FISHING (BLATANT BETA)
local fishing = Window:Tab({
    Title = "Fishing",
    Icon = "fish",
    IconColor = Color3.fromHex("#00ff88"),
    IconShape = true,
})

local blatant = fishing:Section({
    Title = "Blatant Beta",
    Icon = "zap",
    TextXAlignment = "Left",
    TextSize = 17
})

fishing:Divider()

blatant:Toggle({
    Title = "Blatant Beta",
    Desc = "Automated fishing system (experimental)",
    Value = BlatantConfig.Active,
    Callback = function(state)
        ToggleBlatantFishing(state)
        
        if state then
            WindUI:Notify({
                Title = "Blatant Beta Enabled",
                Content = "Auto fishing started",
                Duration = 3,
                Icon = "check"
            })
        else
            WindUI:Notify({
                Title = "Blatant Beta Disabled",
                Content = "Auto fishing stopped",
                Duration = 3,
                Icon = "x"
            })
        end
    end
})

blatant:Input({
    Title = "Cancel Delay",
    Placeholder = "1.6",
    Default = tostring(BlatantConfig.CancelDelay),
    Callback = function(value)
        local num = tonumber(value)
        if num and num > 0 then
            BlatantConfig.CancelDelay = num
            WindUI:Notify({
                Title = "Delay Updated",
                Content = "Cancel delay set to " .. num,
                Duration = 2,
                Icon = "info"
            })
        end
    end
})

blatant:Input({
    Title = "Complete Delay",
    Placeholder = "0.37",
    Default = tostring(BlatantConfig.CompleteDelay),
    Callback = function(value)
        local num = tonumber(value)
        if num and num > 0 then
            BlatantConfig.CompleteDelay = num + 0.5
            WindUI:Notify({
                Title = "Delay Updated",
                Content = "Complete delay set to " .. (num + 0.5),
                Duration = 2,
                Icon = "info"
            })
        end
    end
})
