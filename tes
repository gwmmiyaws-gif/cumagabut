-- Load Wind UI
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

-- Events
local NetPath = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net
local Events = {
    ChargeFishingRod = NetPath["RF/ChargeFishingRod"],
    RequestMinigame = NetPath["RF/RequestFishingMinigameStarted"],
    CatchCompleted = NetPath["RF/CatchFishCompleted"],
    CancelFishing = NetPath["RF/CancelFishingInputs"]
}

-- Settings
local Settings = {
    AutoFish = false,
    BlatantMode = false,
    ChargeTime = 1,
    CastDelay = 0.5,
    CatchDelay = 0.3,
    WebhookEnabled = false,
    WebhookURL = ""
}

-- Stats
local Stats = {
    FishCaught = 0,
    StartTime = tick()
}

-- Create Window
local Window = WindUI:CreateWindow({
    Title = "Auto Fishing",
    Icon = "ðŸŽ£",
    Author = "Patungin",
    Folder = "AutoFishConfig",
    Size = UDim2.fromOffset(480, 520),
    KeySystem = false
})

-- Main Tab
local MainTab = Window:Tab({
    Title = "Main",
    Icon = "home"
})

-- Auto Fish Section
local FishSection = MainTab:Section({
    Title = "Auto Fishing"
})

FishSection:Toggle({
    Title = "Enable Auto Fish",
    Default = false,
    Callback = function(value)
        Settings.AutoFish = value
        if value then
            startAutoFish()
        end
    end
})

FishSection:Toggle({
    Title = "Blatant Mode",
    Description = "Instant everything (risky)",
    Default = false,
    Callback = function(value)
        Settings.BlatantMode = value
    end
})

-- Timing Settings Section
local TimingSection = MainTab:Section({
    Title = "Timing Settings"
})

TimingSection:Slider({
    Title = "Charge Time",
    Description = "Rod charge duration",
    Min = 0.1,
    Max = 3,
    Default = 1,
    Callback = function(value)
        Settings.ChargeTime = value
    end
})

TimingSection:Slider({
    Title = "Cast Delay",
    Description = "Delay before casting",
    Min = 0.1,
    Max = 2,
    Default = 0.5,
    Callback = function(value)
        Settings.CastDelay = value
    end
})

TimingSection:Slider({
    Title = "Catch Delay",
    Description = "Delay before catching",
    Min = 0.1,
    Max = 2,
    Default = 0.3,
    Callback = function(value)
        Settings.CatchDelay = value
    end
})

-- Stats Section
local StatsSection = MainTab:Section({
    Title = "Statistics"
})

local FishLabel = StatsSection:Label({
    Title = "Fish Caught: 0"
})

local TimeLabel = StatsSection:Label({
    Title = "Runtime: 0s"
})

-- Webhook Tab
local WebhookTab = Window:Tab({
    Title = "Webhook",
    Icon = "bell"
})

local WebhookSection = WebhookTab:Section({
    Title = "Discord Webhook"
})

WebhookSection:Toggle({
    Title = "Enable Webhook",
    Default = false,
    Callback = function(value)
        Settings.WebhookEnabled = value
    end
})

WebhookSection:Input({
    Title = "Webhook URL",
    Placeholder = "Enter webhook URL",
    Callback = function(value)
        Settings.WebhookURL = value
    end
})

WebhookSection:Button({
    Title = "Test Webhook",
    Callback = function()
        sendWebhook("ðŸ§ª Test notification from Auto Fishing!")
    end
})

-- Functions
function sendWebhook(message)
    if not Settings.WebhookEnabled or Settings.WebhookURL == "" then return end
    
    local data = {
        content = message,
        embeds = {{
            title = "Auto Fishing Stats",
            fields = {
                {name = "Fish Caught", value = tostring(Stats.FishCaught), inline = true},
                {name = "Runtime", value = formatTime(tick() - Stats.StartTime), inline = true}
            },
            color = 3447003,
            timestamp = DateTime.now():ToIsoDate()
        }}
    }
    
    request({
        Url = Settings.WebhookURL,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = game:GetService("HttpService"):JSONEncode(data)
    })
end

function formatTime(seconds)
    local hours = math.floor(seconds / 3600)
    local mins = math.floor((seconds % 3600) / 60)
    local secs = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", hours, mins, secs)
end

function startAutoFish()
    spawn(function()
        while Settings.AutoFish do
            local success, err = pcall(function()
                -- Charge Rod
                Events.ChargeFishingRod:InvokeServer()
                
                if Settings.BlatantMode then
                    -- Blatant: instant everything
                    task.wait(0.05)
                    Events.RequestMinigame:InvokeServer()
                    task.wait(0.05)
                    Events.CatchCompleted:InvokeServer()
                else
                    -- Legit: dengan delays
                    task.wait(Settings.ChargeTime)
                    task.wait(Settings.CastDelay)
                    Events.RequestMinigame:InvokeServer()
                    task.wait(Settings.CatchDelay)
                    Events.CatchCompleted:InvokeServer()
                end
                
                -- Update stats
                Stats.FishCaught += 1
                FishLabel:Set("Fish Caught: " .. Stats.FishCaught)
                
                -- Webhook setiap 10 fish
                if Stats.FishCaught % 10 == 0 then
                    sendWebhook("ðŸŽ£ Caught " .. Stats.FishCaught .. " fish!")
                end
                
                task.wait(0.5) -- Cooldown
            end)
            
            if not success then
                warn("Error in auto fish loop:", err)
                task.wait(1)
            end
        end
    end)
end

-- Update runtime
spawn(function()
    while true do
        TimeLabel:Set("Runtime: " .. formatTime(tick() - Stats.StartTime))
        task.wait(1)
    end
end)

print("Auto Fishing loaded! Made by Patungin")
