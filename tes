-- MechaPowerBot Fish It - FIXED dengan Parameter Aktual
-- PARAMETER BARU DARI SIMPLESPY: [-1.233, 0.167, 1770117315.399]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local localPlayer = Players.LocalPlayer

-- 1. AMBIL REMOTE FUNCTION dengan path yang valid dari log
local net = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net
local chargeRod = net["RF/ChargeFishingRod"]
local startMinigame = net["RF/RequestFishingMinigameStarted"]
local catchFish = net["RF/CatchFishCompleted"] -- Opsional, cek ketersediaan

-- 2. PARAMETER BARU YANG BERFUNGSI (Dari Log SimpleSpy Anda)
local activeParams = {
    pos = -1.233184814453125,      -- Parameter 1: Posisi
    charge = 0.16703444273073642,  -- Parameter 2: Nilai Charge
    seed = 1770117315.398604       -- Parameter 3: Random Seed
}

-- 3. FUNGSI MEMANCING DASAR YANG SUDAH TERBUKTI
local isFishing = false
local fishingThread = nil

local function doSingleFishingAttempt()
    -- Langkah 1: Charge rod
    local success1 = pcall(function()
        chargeRod:InvokeServer()
        return true
    end)
    
    if not success1 then return false end
    
    -- Langkah 2: Start minigame dengan PARAMETER BARU
    local success2 = pcall(function()
        startMinigame:InvokeServer(activeParams.pos, activeParams.charge, activeParams.seed)
        return true
    end)
    
    if not success2 then return false end
    
    -- Langkah 3: Complete catch (jika remote tersedia)
    if catchFish then
        pcall(function()
            catchFish:InvokeServer()
        end)
    end
    
    return true
end

local function startFishingLoop(speed)
    if isFishing then return end
    
    isFishing = true
    local delay = 1 / speed  -- Konversi dari "catch/detik" ke delay
    
    print("[FIXED SCRIPT] Memulai dengan parameter baru:")
    print("   Pos: " .. activeParams.pos)
    print("   Charge: " .. activeParams.charge)
    print("   Seed: " .. activeParams.seed)
    print("   Delay: " .. delay .. "s (" .. speed .. " catch/detik)")
    
    fishingThread = task.spawn(function()
        while isFishing do
            doSingleFishingAttempt()
            task.wait(delay)
        end
    end)
end

local function stopFishingLoop()
    isFishing = false
    if fishingThread then
        task.cancel(fishingThread)
        fishingThread = nil
    end
    print("[FIXED SCRIPT] Berhenti.")
end

-- 4. GUI SEDERHANA UNTUK KONTROL
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local StartBtn = Instance.new("TextButton")
local StopBtn = Instance.new("TextButton")
local StatusLabel = Instance.new("TextLabel")

ScreenGui.Parent = localPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

MainFrame.Parent = ScreenGui
MainFrame.Size = UDim2.new(0, 200, 0, 150)
MainFrame.Position = UDim2.new(0.8, 0, 0.5, -75)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)

StartBtn.Parent = MainFrame
StartBtn.Text = "▶ START FISHING"
StartBtn.Size = UDim2.new(0.9, 0, 0, 40)
StartBtn.Position = UDim2.new(0.05, 0, 0.1, 0)
StartBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)

StopBtn.Parent = MainFrame
StopBtn.Text = "⏹ STOP"
StopBtn.Size = UDim2.new(0.9, 0, 0, 40)
StopBtn.Position = UDim2.new(0.05, 0, 0.4, 0)
StopBtn.BackgroundColor3 = Color3.fromRGB(180, 0, 0)

StatusLabel.Parent = MainFrame
StatusLabel.Text = "Status: SIAP\nParameter: TERBARU"
StatusLabel.Size = UDim2.new(0.9, 0, 0, 50)
StatusLabel.Position = UDim2.new(0.05, 0, 0.75, 0)
StatusLabel.BackgroundTransparency = 1
StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
StatusLabel.TextWrapped = true

-- 5. EVENT HANDLERS
StartBtn.MouseButton1Click:Connect(function()
    startFishingLoop(50) -- 50 catch/detik untuk awal
    StatusLabel.Text = "Status: BERJALAN\nKecepatan: 50/detik"
    StartBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
end)

StopBtn.MouseButton1Click:Connect(function()
    stopFishingLoop()
    StatusLabel.Text = "Status: BERHENTI\nParameter: TERBARU"
    StartBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
end)

-- 6. INFORMASI AWAL
print("========================================")
print("FISH IT SCRIPT - FIXED & VERIFIED")
print("RemoteFunction: RF/RequestFishingMinigameStarted")
print("Parameter 1 (pos): " .. activeParams.pos)
print("Parameter 2 (charge): " .. activeParams.charge)
print("Parameter 3 (seed): " .. activeParams.seed)
print("========================================")
