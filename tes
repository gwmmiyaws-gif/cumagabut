local WindUI

do
    local ok, result = pcall(function()
        return require("./src/Init")
    end)
    
    if ok then
        WindUI = result
    else 
        WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
    end
end

-- [[ Services Caller Shorcut ]]
local svc = {
	Players = game:GetService("Players"),
	RS = game:GetService("ReplicatedStorage"),
}

-- [[ Local Player + Hrp ]]
local player = svc.Players.LocalPlayer
local hrp = player.Character and player.Character:WaitForChild("HumanoidRootPart") or player.CharacterAdded:Wait():WaitForChild("HumanoidRootPart")

-- [[ Require for RemoteFunction + RemoteEvent Shortcut ]]
local mods = {
	Net = svc.RS.Packages._Index["sleitnick_net@0.2.0"].net,
	Replion = require(svc.RS.Packages.Replion),
}

-- [[ API Caller from shorcut ]]
local api = {
	-- [[ Remote Event ]]
	Events = {
		REFishDone = mods.Net["RE/FishingCompleted"],
	},
	-- [[ Remote Function ]]
	Functions = {
		ChargeRod = mods.Net["RF/ChargeFishingRod"],
		StartMini = mods.Net["RF/RequestFishingMinigameStarted"],
		Cancel = mods.Net["RF/CancelFishingInputs"],
		Done = mods.Net["RF/RequestFishingMinigameStarted"],
		AutoEnabled = mods.Net["RF/UpdateAutoFishingState"],
	},
}


-- */  Window  /* --
local Window = WindUI:CreateWindow({
    Title = "LS Hub - Fish It",
    Author = "developed by Louissxe",
    Folder = "LSHub-FishIt",
    Icon = "rbxassetid://129609617845057",
    Transparent = true,
    IconSize = 12*2,
    NewElements = true,
    Size = UDim2.fromOffset(580, 380),
    ToggleKey = Enum.KeyCode.G,
    User = {
        Enabled = true,
        Anonymous = true,
    },
    HideSearchBar = false,
    OpenButton = {
        Title = "Open LS Hub",
        CornerRadius = UDim.new(0.3,0),
        StrokeThickness = 3,
        Enabled = true,
        Draggable = true,
        OnlyMobile = false,
        Color = ColorSequence.new(
            Color3.fromRGB(107, 49, 255), 
            Color3.fromRGB(215, 48, 221)
        )
    },
    Topbar = {
        Height = 44,
        ButtonsType = "Default",
    },
})

local Fish10 = Window:Tab({
    Title = "Fishing",
    Icon = "bird",
    Locked = false,
})

-- [[ PROTECTED BLATANT ]]
local ThreadGuard = { _sessions = {} }

function ThreadGuard:Next(key)
	self._sessions[key] = (self._sessions[key] or 0) + 1
	return self._sessions[key]
end

function ThreadGuard:IsAlive(key, session)
	return self._sessions[key] == session
end

local TG = ThreadGuard


-- [[ Function Blatant ]]
function Fastest2(session)
	while Protected and TG:IsAlive("BlatantBeta", session) do
		task.spawn(function()
			if not TG:IsAlive("BlatantBeta", session) then
				return
			end
			local now = workspace:GetServerTimeNow()
			api.Functions.ChargeRod:InvokeServer(now) -- Charge Started 
		end)
		task.spawn(function()
			if not TG:IsAlive("BlatantBeta", session) then
				return
			end
			local started = workspace:GetServerTimeNow()
			api.Functions.StartMini:InvokeServer(-1, 1, started) -- Start minigame 
		end)
		task.wait(_G.FishingDelay2)
		if not TG:IsAlive("BlatantBeta", session) then
			break
		end
		task.spawn(function()
			if not TG:IsAlive("BlatantBeta", session) then
				return
			end
			api.Events.REFishDone:FireServer() -- Complete Fishing (Delay Bait)
		end)
		task.wait(_G.Reel2)
		if not TG:IsAlive("BlatantBeta", session) then
			break
		end
		task.spawn(function()
			if not TG:IsAlive("BlatantBeta", session) then
				return
			end
			api.Functions.Cancel:InvokeServer() -- Cancel Fishing (Delay Cast)
		end)
	end
end

Fish10:Input({
	Title = "Delay Bait",
	Value = tostring(_G.Reel2),
	Callback = function(v)
		local n = tonumber(v)
		if n and n > 0 then
			_G.Reel2 = n
		end
	end,
})

Fish10:Input({
	Title = "Delay Cast",
	Value = tostring(_G.FishingDelay2),
	Callback = function(v)
		local n = tonumber(v)
		if n and n > 0 then
			_G.FishingDelay2 = n
		end
	end,
})

Fish10:Toggle({
	Title = "Stable Result v2",
	Default = _G.FStable2,
	Callback = function(s)
		_G.FStable2 = s
	end,
})

Fish10:Toggle({
	Title = "Blatant Fishing v2",
	Default = _G.FBlatant2,
	Callback = function(s)
		if _G.FBlatant2 == s then
			return
		end
		_G.FBlatant2 = s

		api.Functions.AutoEnabled:InvokeServer(s and _G.FStable2) -- for byoassed auto from games

		local session = TG:Next("BlatantBeta")

		if s then
			Protected = true
			player:SetAttribute("Loading", nil) -- bypassed character not casting
			task.spawn(function()
				Fastest2(session)
			end)
		else
			Protected = false
			player:SetAttribute("Loading", false) -- back normal
			TG:Next("BlatantBeta")
		end
	end,
})

Fish10:Button({
	Title = "Recovery Fishing",
	Callback = function()
		task.spawn(function()
			api.Functions.Cancel:InvokeServer()
		end)
	end,
})
