-- Load Wind UI
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer

-- Events
local NetPath = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net
local Events = {
    ChargeFishingRod = NetPath["RF/ChargeFishingRod"],
    RequestMinigame = NetPath["RF/RequestFishingMinigameStarted"],
    CatchCompleted = NetPath["RF/CatchFishCompleted"],
    CancelFishing = NetPath["RF/CancelFishingInputs"]
}

-- Settings
local Settings = {
    AutoFish = false,
    BlatantMode = false,
    ChargeTime = 1,
    CastDelay = 0.5,
    CompleteDelay = 0.3,
    CycleDelay = 0.5,
    MinigameParam1Min = 5,
    MinigameParam1Max = 10,
    MinigameParam2Min = 0,
    MinigameParam2Max = 0.1,
    WebhookEnabled = false,
    WebhookURL = ""
}

-- Stats
local Stats = {
    FishCaught = 0,
    StartTime = tick()
}

-- Create Window
local Window = WindUI:CreateWindow({
    Title = "Auto Fishing",
    Icon = "ðŸŽ£",
    Author = "Patungin",
    Folder = "AutoFishConfig",
    Size = UDim2.fromOffset(500, 600),
    KeySystem = false
})

-- Main Tab
local MainTab = Window:Tab({
    Title = "Main",
    Icon = "home"
})

-- Auto Fish Section
local FishSection = MainTab:Section({
    Title = "Auto Fishing Controls"
})

local AutoFishToggle = FishSection:Toggle({
    Title = "Enable Auto Fish",
    Default = false,
    Callback = function(value)
        Settings.AutoFish = value
        if value then
            Stats.StartTime = tick()
            Stats.FishCaught = 0
            startAutoFish()
        end
    end
})

local BlatantButton = FishSection:Button({
    Title = "Blatant Mode: OFF",
    Callback = function()
        Settings.BlatantMode = not Settings.BlatantMode
        BlatantButton:Set({
            Title = Settings.BlatantMode and "Blatant Mode: ON" or "Blatant Mode: OFF"
        })
    end
})

-- Timing Settings Section
local TimingSection = MainTab:Section({
    Title = "Timing Settings (Legit Mode)"
})

TimingSection:Slider({
    Title = "Charge Time",
    Description = "Rod charge duration",
    Min = 0.1,
    Max = 3,
    Default = 1,
    Callback = function(value)
        Settings.ChargeTime = value
    end
})

TimingSection:Slider({
    Title = "Cast Delay",
    Description = "Delay before casting",
    Min = 0.1,
    Max = 2,
    Default = 0.5,
    Callback = function(value)
        Settings.CastDelay = value
    end
})

TimingSection:Input({
    Title = "Complete Delay",
    Description = "Delay before completing catch (in seconds)",
    Placeholder = "0.3",
    Default = "0.3",
    Callback = function(value)
        local num = tonumber(value)
        if num then
            Settings.CompleteDelay = num
        end
    end
})

TimingSection:Input({
    Title = "Cycle Delay",
    Description = "Delay between fishing cycles (in seconds)",
    Placeholder = "0.5",
    Default = "0.5",
    Callback = function(value)
        local num = tonumber(value)
        if num then
            Settings.CycleDelay = num
        end
    end
})

-- Advanced Settings
local AdvancedSection = MainTab:Section({
    Title = "Advanced Settings"
})

AdvancedSection:Input({
    Title = "Minigame Param 1 Min",
    Description = "Minimum value for first parameter",
    Placeholder = "5",
    Default = "5",
    Callback = function(value)
        local num = tonumber(value)
        if num then
            Settings.MinigameParam1Min = num
        end
    end
})

AdvancedSection:Input({
    Title = "Minigame Param 1 Max",
    Description = "Maximum value for first parameter",
    Placeholder = "10",
    Default = "10",
    Callback = function(value)
        local num = tonumber(value)
        if num then
            Settings.MinigameParam1Max = num
        end
    end
})

AdvancedSection:Input({
    Title = "Minigame Param 2 Min",
    Description = "Minimum value for second parameter",
    Placeholder = "0",
    Default = "0",
    Callback = function(value)
        local num = tonumber(value)
        if num then
            Settings.MinigameParam2Min = num
        end
    end
})

AdvancedSection:Input({
    Title = "Minigame Param 2 Max",
    Description = "Maximum value for second parameter",
    Placeholder = "0.1",
    Default = "0.1",
    Callback = function(value)
        local num = tonumber(value)
        if num then
            Settings.MinigameParam2Max = num
        end
    end
})

-- Stats Section
local StatsSection = MainTab:Section({
    Title = "Statistics"
})

local FishLabel = StatsSection:Label({
    Title = "Fish Caught: 0"
})

local TimeLabel = StatsSection:Label({
    Title = "Runtime: 00:00:00"
})

local StatusLabel = StatsSection:Label({
    Title = "Status: Idle"
})

-- Webhook Tab
local WebhookTab = Window:Tab({
    Title = "Webhook",
    Icon = "bell"
})

local WebhookSection = WebhookTab:Section({
    Title = "Discord Webhook"
})

WebhookSection:Toggle({
    Title = "Enable Webhook",
    Default = false,
    Callback = function(value)
        Settings.WebhookEnabled = value
    end
})

WebhookSection:Input({
    Title = "Webhook URL",
    Description = "Paste your Discord webhook URL",
    Placeholder = "https://discord.com/api/webhooks/...",
    Callback = function(value)
        Settings.WebhookURL = value
    end
})

WebhookSection:Button({
    Title = "Test Webhook",
    Callback = function()
        if Settings.WebhookURL ~= "" then
            sendWebhook("ðŸ§ª Test notification from Auto Fishing!")
            Window:Notify({
                Title = "Webhook Test",
                Content = "Test message sent!",
                Duration = 3
            })
        else
            Window:Notify({
                Title = "Error",
                Content = "Please enter webhook URL first!",
                Duration = 3
            })
        end
    end
})

-- Functions
function sendWebhook(message)
    if not Settings.WebhookEnabled or Settings.WebhookURL == "" then return end
    
    pcall(function()
        local data = {
            content = message,
            embeds = {{
                title = "ðŸŽ£ Auto Fishing Stats",
                fields = {
                    {name = "Fish Caught", value = tostring(Stats.FishCaught), inline = true},
                    {name = "Runtime", value = formatTime(tick() - Stats.StartTime), inline = true},
                    {name = "Mode", value = Settings.BlatantMode and "Blatant" or "Legit", inline = true}
                },
                color = Settings.BlatantMode and 16711680 or 3447003,
                timestamp = DateTime.now():ToIsoDate()
            }}
        }
        
        request({
            Url = Settings.WebhookURL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = game:GetService("HttpService"):JSONEncode(data)
        })
    end)
end

function formatTime(seconds)
    local hours = math.floor(seconds / 3600)
    local mins = math.floor((seconds % 3600) / 60)
    local secs = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", hours, mins, secs)
end

function startAutoFish()
    spawn(function()
        while Settings.AutoFish do
            local success, err = pcall(function()
                StatusLabel:Set("Status: Charging Rod...")
                
                -- Step 1: Charge Rod
                local chargeTime = tick()
                Events.ChargeFishingRod:InvokeServer(nil, nil, chargeTime, nil)
                
                if Settings.BlatantMode then
                    task.wait(0.05)
                else
                    task.wait(Settings.ChargeTime)
                end
                
                StatusLabel:Set("Status: Casting...")
                
                if not Settings.BlatantMode then
                    task.wait(Settings.CastDelay)
                end
                
                -- Step 2: Request Minigame dengan random parameters
                local minigameTime = tick()
                local param1 = math.random() * (Settings.MinigameParam1Max - Settings.MinigameParam1Min) + Settings.MinigameParam1Min
                local param2 = math.random() * (Settings.MinigameParam2Max - Settings.MinigameParam2Min) + Settings.MinigameParam2Min
                
                StatusLabel:Set("Status: Minigame Started...")
                Events.RequestMinigame:InvokeServer(param1, param2, minigameTime)
                
                if Settings.BlatantMode then
                    task.wait(0.05)
                else
                    task.wait(Settings.CompleteDelay)
                end
                
                -- Step 3: Complete Catch
                StatusLabel:Set("Status: Catching Fish...")
                Events.CatchCompleted:InvokeServer()
                
                -- Update stats
                Stats.FishCaught += 1
                FishLabel:Set("Fish Caught: " .. Stats.FishCaught)
                StatusLabel:Set("Status: Fish Caught! (" .. Stats.FishCaught .. ")")
                
                -- Webhook notification every 10 fish
                if Stats.FishCaught % 10 == 0 then
                    sendWebhook("ðŸŽ£ Caught **" .. Stats.FishCaught .. "** fish! Still farming...")
                end
                
                -- Cycle delay
                if Settings.BlatantMode then
                    task.wait(0.1)
                else
                    task.wait(Settings.CycleDelay)
                end
            end)
            
            if not success then
                warn("Auto Fish Error:", err)
                StatusLabel:Set("Status: Error - " .. tostring(err))
                task.wait(2)
            end
        end
        
        StatusLabel:Set("Status: Stopped")
    end)
end

-- Update runtime display
spawn(function()
    while true do
        if Settings.AutoFish then
            TimeLabel:Set("Runtime: " .. formatTime(tick() - Stats.StartTime))
        end
        task.wait(1)
    end
end)

-- Notification on load
Window:Notify({
    Title = "Auto Fishing Loaded!",
    Content = "Made by Patungin | Ready to farm!",
    Duration = 5
})

print("ðŸŽ£ Auto Fishing Script Loaded!")
print("Made by Patungin")
