local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

-- Services
local svc = {
    Players = game:GetService("Players"),
    RS = game:GetService("ReplicatedStorage"),
    Workspace = game:GetService("Workspace")
}

local player = svc.Players.LocalPlayer

-- Events/Functions
local mods = {
    Net = svc.RS.Packages._Index["sleitnick_net@0.2.0"].net,
}

local api = {
    Events = {
        EquipTool = mods.Net["RE/EquipToolFromHotbar"],
    },
    Functions = {
        ChargeRod = mods.Net["RF/ChargeFishingRod"],
        StartMini = mods.Net["RF/RequestFishingMinigameStarted"],
        CatchFish = mods.Net["RF/CatchFishCompleted"],
        CancelFish = mods.Net["RF/CancelFishingInputs"],
    },
}

-- Settings
local Settings = {
    Enabled = false,
    BlatantMode = false,
    AutoEquip = true,
    
    -- Timing
    DelayComplete = 0.01,
    DelayCycle = 0.1,
    
    -- Spam counts
    RapidCalls = 115,
    SlowCalls = 15,
}

-- Stats
local Stats = {
    FishCaught = 0,
    CycleCount = 0,
    StartTime = 0,
}

local FishingSession = 0

-- Create Window
local Window = WindUI:CreateWindow({
    Title = "Auto Fishing",
    Icon = "ðŸŽ£",
    Author = "Patungin",
    Folder = "AutoFishConfig",
    Size = UDim2.fromOffset(500, 550),
    KeySystem = false,
    ToggleKey = Enum.KeyCode.G,
})

-- Main Tab
local MainTab = Window:Tab({
    Title = "Main",
    Icon = "home"
})

-- Control Section
local ControlSection = MainTab:Section({
    Title = "Fishing Controls"
})

local StartToggle = ControlSection:Toggle({
    Title = "Start Auto Fish",
    Default = false,
    Callback = function(value)
        Settings.Enabled = value
        
        if value then
            Stats.StartTime = tick()
            Stats.FishCaught = 0
            Stats.CycleCount = 0
            FishingSession = FishingSession + 1
            
            local currentSession = FishingSession
            
            task.spawn(function()
                if Settings.BlatantMode then
                    BlatantFishing(currentSession)
                else
                    NormalFishing(currentSession)
                end
            end)
            
            Window:Notify({
                Title = "Auto Fish Started",
                Content = "Fishing mode: " .. (Settings.BlatantMode and "Blatant" or "Legit"),
                Duration = 3
            })
        else
            FishingSession = FishingSession + 1
            Window:Notify({
                Title = "Auto Fish Stopped",
                Content = "Total fish: " .. Stats.FishCaught,
                Duration = 3
            })
        end
    end
})

ControlSection:Toggle({
    Title = "Blatant Mode",
    Description = "Spam pattern for maximum speed",
    Default = false,
    Callback = function(value)
        Settings.BlatantMode = value
    end
})

ControlSection:Toggle({
    Title = "Auto Equip Rod",
    Description = "Auto equip fishing rod on start",
    Default = true,
    Callback = function(value)
        Settings.AutoEquip = value
    end
})

-- Timing Section
local TimingSection = MainTab:Section({
    Title = "Timing Settings"
})

TimingSection:Input({
    Title = "Complete Delay",
    Description = "Delay between rapid calls (seconds)",
    Placeholder = "0.01",
    Default = "0.01",
    Callback = function(value)
        local num = tonumber(value)
        if num and num >= 0.001 then
            Settings.DelayComplete = num
        end
    end
})

TimingSection:Input({
    Title = "Cycle Delay",
    Description = "Delay between fishing cycles (seconds)",
    Placeholder = "0.1",
    Default = "0.1",
    Callback = function(value)
        local num = tonumber(value)
        if num and num >= 0 then
            Settings.DelayCycle = num
        end
    end
})

-- Advanced Section
local AdvancedSection = MainTab:Section({
    Title = "Advanced (Blatant Mode)"
})

AdvancedSection:Input({
    Title = "Rapid Calls",
    Description = "Number of rapid spam calls",
    Placeholder = "115",
    Default = "115",
    Callback = function(value)
        local num = tonumber(value)
        if num and num > 0 then
            Settings.RapidCalls = num
        end
    end
})

AdvancedSection:Input({
    Title = "Slow Calls",
    Description = "Number of slow spam calls",
    Placeholder = "15",
    Default = "15",
    Callback = function(value)
        local num = tonumber(value)
        if num and num > 0 then
            Settings.SlowCalls = num
        end
    end
})

-- Stats Section
local StatsSection = MainTab:Section({
    Title = "Statistics"
})

local FishLabel = StatsSection:Label({
    Title = "Fish Caught: 0"
})

local CycleLabel = StatsSection:Label({
    Title = "Cycles: 0"
})

local TimeLabel = StatsSection:Label({
    Title = "Runtime: 00:00:00"
})

local StatusLabel = StatsSection:Label({
    Title = "Status: Idle"
})

-- Functions
local function IsSessionAlive(session)
    return FishingSession == session and Settings.Enabled
end

local function formatTime(seconds)
    local hours = math.floor(seconds / 3600)
    local mins = math.floor((seconds % 3600) / 60)
    local secs = math.floor(seconds % 60)
    return string.format("%02d:%02d:%02d", hours, mins, secs)
end

-- Normal Fishing (Legit Mode)
function NormalFishing(session)
    if Settings.AutoEquip then
        pcall(api.Events.EquipTool.FireServer, api.Events.EquipTool, 1)
        task.wait(0.5)
    end
    
    while IsSessionAlive(session) do
        pcall(function()
            StatusLabel:Set("Status: Charging...")
            
            -- Charge Rod
            local now = workspace:GetServerTimeNow()
            api.Functions.ChargeRod:InvokeServer(nil, nil, now, nil)
            task.wait(Settings.DelayComplete)
            
            StatusLabel:Set("Status: Starting Minigame...")
            
            -- Start Minigame
            local param1 = math.random() * 10 + 5
            local param2 = math.random() * 0.1
            api.Functions.StartMini:InvokeServer(param1, param2, now)
            task.wait(Settings.DelayComplete)
            
            StatusLabel:Set("Status: Catching...")
            
            -- Catch Fish
            api.Functions.CatchFish:InvokeServer()
            
            Stats.FishCaught = Stats.FishCaught + 1
            Stats.CycleCount = Stats.CycleCount + 1
            
            FishLabel:Set("Fish Caught: " .. Stats.FishCaught)
            CycleLabel:Set("Cycles: " .. Stats.CycleCount)
            
            task.wait(Settings.DelayCycle)
        end)
    end
    
    StatusLabel:Set("Status: Stopped")
end

-- Blatant Fishing (Spam Pattern)
function BlatantFishing(session)
    if Settings.AutoEquip then
        pcall(api.Events.EquipTool.FireServer, api.Events.EquipTool, 1)
        task.wait(0.5)
    end
    
    while IsSessionAlive(session) do
        pcall(function()
            Stats.CycleCount = Stats.CycleCount + 1
            CycleLabel:Set("Cycles: " .. Stats.CycleCount)
            
            StatusLabel:Set("Status: Rapid Spam Phase...")
            
            -- Phase 1: Rapid Spam (ChargeRod + StartMini)
            for i = 1, Settings.RapidCalls do
                if not IsSessionAlive(session) then return end
                
                local now = workspace:GetServerTimeNow()
                
                pcall(function()
                    api.Functions.ChargeRod:InvokeServer(now + (i * 0.000001))
                end)
                
                pcall(function()
                    api.Functions.StartMini:InvokeServer(-1, 1, now + (i * 0.000001) + 0.0001)
                end)
                
                task.wait(Settings.DelayComplete)
            end
            
            StatusLabel:Set("Status: Slow Spam Phase...")
            
            -- Phase 2: Slow Spam (CatchFish + CancelFish)
            local slowDelay = (Settings.RapidCalls * Settings.DelayComplete) / Settings.SlowCalls
            
            for i = 1, Settings.SlowCalls do
                if not IsSessionAlive(session) then return end
                
                pcall(function()
                    api.Functions.CatchFish:InvokeServer()
                end)
                
                pcall(function()
                    api.Functions.CancelFish:InvokeServer()
                end)
                
                task.wait(slowDelay)
            end
            
            Stats.FishCaught = Stats.FishCaught + 1
            FishLabel:Set("Fish Caught: " .. Stats.FishCaught)
            
            StatusLabel:Set("Status: Cycle Complete, waiting...")
            task.wait(Settings.DelayCycle)
        end)
    end
    
    StatusLabel:Set("Status: Stopped")
end

-- Update runtime
spawn(function()
    while true do
        if Settings.Enabled then
            TimeLabel:Set("Runtime: " .. formatTime(tick() - Stats.StartTime))
        end
        task.wait(1)
    end
end)

-- Load notification
Window:Notify({
    Title = "Auto Fishing Loaded!",
    Content = "Made by Patungin | Ready to fish!",
    Duration = 5
})

print("ðŸŽ£ Auto Fishing Script Loaded!")
